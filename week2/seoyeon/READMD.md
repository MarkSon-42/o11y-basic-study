# Chap1. 관측 가능성의 개념과 방향성

<aside>

💡 Week 2 

**마감: 11.11(월)** 

</aside>

## 1. 관측 가능성의 세 가지 요소

**관측 가능성이란,**

시스템에서 외부로 출력되는 값만을 사용해 시스템의 내부 상태를 이해하고 예측하는 것

내부 시스템에 대한 자세한 이해를 기반으로 미래에 발생할 이벤트를 예측하고, 이를 바탕으로 IT 운영을 자동화하는 것

**모니터링 vs 관측 가능성**

![image.png](Chap1%20%E1%84%80%E1%85%AA%E1%86%AB%E1%84%8E%E1%85%B3%E1%86%A8%20%E1%84%80%E1%85%A1%E1%84%82%E1%85%B3%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%E1%84%8B%E1%85%B4%20%E1%84%80%E1%85%A2%E1%84%82%E1%85%A7%E1%86%B7%E1%84%80%E1%85%AA%20%E1%84%87%E1%85%A1%E1%86%BC%E1%84%92%E1%85%A3%E1%86%BC%E1%84%89%E1%85%A5%E1%86%BC%2013bdeb6219af80869a8ec0f8ec490d78/image.png)

**관측 가능성의 세 가지 요소** 

⇒ 메트릭, 로그, 추적

## 2. 메트릭

**구글의 골든 시그널**

: 지연, 에러, 트래픽, 포화

**메트릭 유형**

1. 카운터
    1. 모니터링하는 이벤트의 누적 개수 혹은 크기
2. 게이지
    1. 증가하거나 감소하는 임의의 값
3. 요약
    1. 응답의 크기와 대기시간을 추적하는 데에도 사용하며, 측정한 이벤트의 합계와 카운트 제공
4. 히스토그램
    1. 시간 경과에 따른 추세와 단일 분포에서의 데이터 분포

## 3. 추적

**용어 설명**

- 스팬
    - 동작 정보, 타임라인과 부모 스팬과의 의존성을 모두 포함하는 수행 시간을 담음
    - Tag, Log, SpanContext, Baggage 정보 포함
- 스팬 콘텍스트
    - 새로운 스팬을 생성하기 위해 다른 스팬을 참조해야 하는데, 이때 필요한 정보 제공
- 스팬 레퍼런스
    - 두 스팬 사이의 인과관계
    - 스팬이 동일한 추적에 속한다는 것을 tracer가 알 수 있게 함

## 4. 로그

**로그 관리**

> 일차적인 목적은 시스템에 분산된 로그를 한곳에 저장하는 것
> 

로그 수집과 통합, 관리 방식 결정 → 로그 표준화 

**로그에 포함할 정보**

- 타임스탬프
- 식별자
- 소스
- 레벨 또는 카테고리

**로그 표준화**

각 시스템 별로 생성되는 로그 파일을 표준화시키고 동일한 ID를 사용해야 함

로그 관리 시스템에서 입력되는 키와 로그 파일의 키가 일치하도록 표준화 진행해야 함

## 5. 상관관계

> 본 책에서는 최종적으로 다섯 가지 신호를 다룸 : 로그, 메트릭, 추적, 프로파일, RUM
하지만 현재는 로그, 메트릭, 추적에 집중
> 

**로그와 추적**

- 로그 파일에 추적을 식별하는 추적 ID 추가 가능
- 스팬 콘텍스트 내 메타뎅터에 로그 파일명 추가 가능
- 로그 관리 화면에서 특정 로그 파일 선택하면 추적 ID 출력
- 추적 화면에서 추적 ID를 선택하면 해당 추적 ID를 포함한 로그 파일로 이동

**추적과 메트릭**

- [이그젬플러(프로메테우스 내부 저장소) 기능 활용] 이그젬플러에 추적을 저장하고, 히스토그램에 출력되는 이그젬플러를 추적 ID와 일치시킬 수 있음
- 메트릭에서 추적 정보를 수집하고, 내부적으로 다양한 연산을 통해 메트릭 값 생성

**메트릭과 로그**

- 메트릭과 로그의 관계를 나타내는 기술은 아직 존재하지 않음

**애플리케이션 데이터와 연계한 관측 가능성**

- 잘 구축된 관측 가능성을 통해 시스템 내부의 문맥을 신속하게 이해하고 적절한 조치를 취할 수 있음
- 로그, 메트릭, 추적 등을 한 화면에서 확인함으로써 생산성 향상 가능
- 상관관계를 정의하고 한 저장소에서 관리하여 데이터 분석 가능
- 나아가 예측 가능한 모델을 구현해 인프라 자동화와 이상 탐지 혹은 장애 예측 등 새로운 인사이트 기대

## 6. 관측 가능성 데모

**구성**

- 애플리케이션
    - Kubernetes로 배포
    - 가급적 MSA 형태로 구현
- 컬렉터
    - 중간 게이트웨이 역할
    - 관측 가능성 오픈소스에 따라 다름
- 관측 가능성
    - 로키, 템포, 프로메테우스, 미미르
    - 소스 대신 Kubernetes YAML 사용

## 8. 관측 가능성 오픈소스

**책에서 사용하는 오픈소스**

- 오픈텔레메트리
    - 계측을 위한 표준화된 도구, API, SDK 모음
- 로키
    - 그라파나의 로그 관리 시스템
- 그라파나 미미르
    - 프로메테우스용 오픈소스, 수평 확장성, 고가용성, 멀티 테넌트, 장기 저장소
- 타노스
    - 다수의 프로메테우스를 통합하는 글로벌 뷰 제공
    - 대용량 메트릭 관리를 위한 장기 저장소 제공
- 예거
    - 분산 콘텍스트 전파를 포함한 마이크로서비스 기반 분산 시스템 모니터링 및 추적을 위해 사용
- 그라파나 템포
    - 그라파나의 오픈소스 추적 솔루션